/* This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/. */

#include <boost/test/unit_test.hpp>
#include "gto_d1_kit/gto_d1.hpp"
#include <armadillo>

using namespace boost::unit_test; 

BOOST_AUTO_TEST_SUITE(gto_d1_kit_kinetic_test)

const double ae = 1.1;
const double be = 1.7;
const double cc = ae * be / (ae + be);
const double xAB = 1.1;
const double yAB = 2.3;
const double zAB = 1.6;

#define CHECK_GRADIENT(grad, ref_grad)                                       \
    for (unsigned i = 0; i < grad.n_rows; ++i)                               \
        for (unsigned j = 0; j < grad.n_cols; ++j)                           \
            for (int k = 0; k < 3; ++k)                                      \
                BOOST_CHECK_CLOSE(grad(i, j, k), ref_grad(i, j, k), 1e-5)

#define GENERATE_TEST_CASE(m, n, d)                                          \
    arma::cube grad(2 * m + 1, 2 * n + 1, 3, arma::fill::zeros);             \
    kinetic_gradient_##m##n(ae, be, cc, xAB, yAB, zAB,                       \
                            grad.slice(0).begin(),                           \
                            grad.slice(1).begin(),                           \
                            grad.slice(2).begin(),                           \
                            2 * n + 1, 0, 0);                                \
    CHECK_GRADIENT(grad, arma::cube(d, grad.n_rows, grad.n_cols, 3))


BOOST_AUTO_TEST_CASE(kinetic_ss)
{
    const double data[] = {
        5.5311524416363893,
        
        11.565136923421543,
        
        8.0453126423802033
    };
    GENERATE_TEST_CASE(0, 0, data);
}

BOOST_AUTO_TEST_CASE(kinetic_sp)
{
    const double data[] = {
        0.23816994223641691, 3.5902742972487482, 2.4975821198252168,
        
        3.59027429724875,    6.0280194018312372, 5.2222171596345452,
        
        2.4975821198252159,  5.2222171596345426, 2.1539289546023497
    };
    
    GENERATE_TEST_CASE(0, 1, data);
}

BOOST_AUTO_TEST_CASE(kinetic_sd)
{
    const double data[] = {
        -0.028931175058652725, 2.3764063786967884, 0.20186082355363871, -0.020126034823410549, -2.1125651083879862,
        
         2.6208747709183884, 3.8121814849722004, 0.42207263106669807, 2.3764063786967897, -1.0917604694403997,
         
         2.3764063786967871, 1.7938805358735421, -1.709792374156111, 0.85794286498299877, -1.9161537598978042
    };
    
    GENERATE_TEST_CASE(0, 2, data);
}

BOOST_AUTO_TEST_CASE(kinetic_sf)
{
    const double data[] = {
        -1.3533535374657162, -0.6052287576113996, -4.8552065572240259, -0.07209839191207458, 0.050475693308617106, -1.8909911695907164, -0.4217068951960346,
        
        0.63631933675702079, 1.0257784065308735, -7.6003382516761571, -0.15075118308888538, 0.58291879772241262, 0.064749374189723652, 4.2318031995673469,
        
        -0.22839207132527306, 0.20948835679707747, -5.714225795616124, -0.664117207166942, -0.66889860186028283, -0.23888260936641439, 3.7760954351283034
    };
    
    GENERATE_TEST_CASE(0, 3, data);
}

BOOST_AUTO_TEST_CASE(kinetic_ps)
{
    const double data[] = {
        -0.3680808198199176,
        -5.548605732111701,
        -3.85989963972988,

        -5.548605732111703,
        -9.316029984648274,
        -8.070699246707933,

        -3.85989963972988,
        -8.07069924670793,
        -3.328799293476359
    };
    
    GENERATE_TEST_CASE(1, 0, data);
}

BOOST_AUTO_TEST_CASE(kinetic_pp)
{
    const double data[] = {
         1.4314267572501453, 0.025814379003404313, 0.01795782887193343,
         0.025814379003404535, -2.3385242569576827, -2.1203927874142803,
         0.017957828871933524, -2.1203927874142807, -0.76551547716393653,
        
         0.025814379003403793, -2.3385242569576827, -2.1203927874142816,
        -2.3385242569576827, -1.9224727874828003, -3.4014898283020845,
        -2.1203927874142821, -3.4014898283020849, -1.6006232704336871,
         
         0.017957828871933403, -2.1203927874142803, -0.76551547716393642,
        -2.1203927874142807, -3.4014898283020836, -1.6006232704336856,
        -0.76551547716393653, -1.6006232704336854, 0.95064039670800582
    };
    
    GENERATE_TEST_CASE(1, 1, data);
}

BOOST_AUTO_TEST_CASE(kinetic_pd)
{
    const double data[] = {
         1.6378140838276385, 0.41830281722302054, -0.2283971431003041, 1.1393489278800966, 0.085278420550359016,
         0.59559267622871392, -0.7089649853913742, -0.65196784097282467, 0.41830281722302098, 0.65336017667046431,
         0.41830281722302098, -0.14478751830874473, 0.35990707255123672, 0.28527564062576705, 0.92415695663573505,
         
         0.59559267622871415, -0.7089649853913742, -0.6519678409728259, 0.41830281722302032, 0.65336017667046342,
         0.33109373048671181, 0.48159088070794481, -1.279791922218537, -0.70896498539137431, -1.672856262922404,
        -0.70896498539137498, 0.051784306752375865, 0.7525329698798584, -0.14478751830874551, -0.031644031742461692,
         
         0.41830281722302076, -0.14478751830874423, 0.35990707255123661, 0.28527564062576694, 0.92415695663573449,
        -0.70896498539137376, 0.051784306752375865, 0.75253296987985896, -0.14478751830874473, -0.031644031742461096,
        -0.14478751830874423, 1.7533721871680967, 1.2209646078825409, 0.83856930690648124, 0.11674566693669455
    };
    
    GENERATE_TEST_CASE(1, 2, data);
}

BOOST_AUTO_TEST_CASE(kinetic_pf)
{
    const double data[] = {
        -0.077224435844198719, 1.455284188098189, -1.0135165536327133, -0.60546563179869606, 0.34690633535348231, -0.83208722042408456, 2.6562303589340965,
        -0.050733837806394719, 1.5139232342491764, 1.1162588666871516, -1.203679716451451, 0.24359853778669299, -1.0592005267896949, 1.2570525928726097,
         0.28835242729626404, 0.9644312542367145, 1.1243049341631279, -0.55515790237402485, -0.019660837299177281, -0.942493455478985, 1.0209636252598526,
        
        -0.050733837806395461, 1.5139232342491766, 1.1162588666871511, -1.203679716451453, 0.24359853778669241, -1.0592005267896969, 1.2570525928726095,
        -0.90129625621356191, 2.9532199383569071, -1.6785715905004446, -2.5465775856018293, 0.12089489209326797, -4.1949939273377828, 0.20393715936260209,
        -0.59293386432290784, 1.8769384795275683, 1.2215257722983737, -1.1607847049638684, 0.53682740941826734, -2.2155121633913337, -0.85267855271835524,
        
         0.28835242729626398, 0.9644312542367145, 1.1243049341631268, -0.55515790237402496, -0.019660837299177353, -0.94249345547898522, 1.0209636252598526,
        -0.59293386432290651, 1.8769384795275685, 1.2215257722983739, -1.1607847049638678, 0.53682740941826801, -2.2155121633913306, -0.85267855271835469,
        -0.24583586115138056, 1.9509246936984994, -0.45305425380134356, -1.5143448233419063, 0.55410700677017866, -2.2246677029382869, 0.19245156193582436
    };
    
    GENERATE_TEST_CASE(1, 3, data);
}

BOOST_AUTO_TEST_CASE(kinetic_ds)
{
    const double data[] = {
        -0.06910007927231773,
         5.675879697879106,
         0.4821303967520781,
        -0.04806962036335138,
        -5.045713358050644,

         6.259775279300943,
         9.105127678983191,
         1.008090829572529,
         5.675879697879108,
        -2.60759318734112,

         5.675879697879105,
         4.284557643532676,
        -4.083718976290217,
         2.049136264298237,
        -4.576598649673271
    };
    
    GENERATE_TEST_CASE(2, 0, data);
}

BOOST_AUTO_TEST_CASE(kinetic_dp)
{
   const double data[] = {
-2.5311672204608948, -0.92046140871710447, -0.64646799025375956, 
-0.64646799025375934, 1.0956731592412123, 0.22376252829533258, 
0.35297740297319757, 1.0075866633216379, -0.55622002121554737, 
-1.7608119794510573, -0.64646799025375989, -0.44088053551254913, 
-0.13179392266873624, -1.0097384548543524, -1.4282425693461354, 
-0.9204614087171028, -0.51169031075218963, 1.0956731592412159, 
1.0956731592412154, -0.74427681563954884, -0.080030292253670129, 
1.0075866633216393, 1.9778602434286474, -1.1630054989052365, 
-0.64646799025375878, 1.095673159241215, 0.22376252829533322, 
-1.0097384548543529, 2.5853233154255335, 0.048904412692895402, 
-0.64646799025375878, 1.0956731592412128, 0.22376252829533322, 
0.22376252829533322, -0.080030292253673224, -2.7097570165325129, 
-0.55622002121554737, -1.163005498905237, -1.886945303091202, 
-0.44088053551254885, 0.22376252829533166, -1.295970747037289, 
-1.4282425693461349, 0.048904412692895145, -0.18042512162943758
   };
   
   GENERATE_TEST_CASE(2, 1, data);
}

BOOST_AUTO_TEST_CASE(kinetic_dd)
{
    const double data[] = {
        -1.943678851501607, -1.8123234736839999, 0.13415536540256046, -1.7421264403010106, 0.80666655166080381,
        -1.8123234736840002, -2.2468904553113527, 0.17508677672870235, -1.1545244575591336, 0.89659239677719971,
        0.13415536540256134, 0.17508677672870426, -0.29596755043961748, 0.34133109444388909, -0.70759690992121038,
        -1.7421264403010106, -1.154524457559134, 0.34133109444388887, -0.65128613899569454, 0.70434545340424981,
        0.80666655166080514, 0.8965923967772037, -0.70759690992121005, 0.70434545340425037, -0.069049413670564566,
        
        -2.1935549182051433, -3.5353112338554169, 1.033014597182808, -1.8123234736840004, 2.0924453710906676,
        -3.5353112338554169, -4.9052993305374226, 0.62368447351626488, -2.2468904553113536, 3.5509797858365038,
        1.0330145971828089, 0.62368447351626544, -0.61884124182829292, 0.17508677672870401, -0.54626343523532495,
        -1.8123234736840002, -2.2468904553113527, 0.17508677672870401, -1.1545244575591336, 0.89659239677720115,
        2.0924453710906685, 3.5509797858365051, -0.54626343523532461, 0.89659239677720204, -2.0148769089730325,
        
        -1.8123234736840004, -2.2468904553113527, 0.17508677672870296, -1.1545244575591338, 0.8965923967772006,
        -2.2468904553113536, -4.2830500634984849, -0.39144567202773445, -2.335459644050629, 1.8753874364891414,
        0.17508677672870449, -0.391445672027734, 0.46183332965287754, -0.1872131474915249, -0.14117668953618898,
        -1.154524457559134, -2.335459644050629, -0.18721314749152401, -0.51677522249984453, 0.79780215815783018,
        0.89659239677720382, 1.8753874364891443, -0.14117668953618839, 0.7978021581578304, -1.4233171662161272
    };
    
    GENERATE_TEST_CASE(2, 2, data);
}

BOOST_AUTO_TEST_CASE(kinetic_df)
{
    const double data[] = {
        1.7290187387094897, -0.97380172168966139, 3.5356687580513166, 0.94318656298746018, -0.75854856507488688, 3.6443285458943704, -2.7901871241308718,
        1.6122402410712571, -2.9410916897723851, 3.2405700870978027, 2.629775146735005, -0.22489907358255992, 5.2282921306032426, -3.263113571584082,
        -0.40363871468356649, 0.2575627930432936, -1.795332730839631, 0.2155061664581083, 0.72782865124364493, -0.48387371494547637, -0.29820994894258041,
        1.4494618163821216, -0.30787767355539569, 2.1704694459749705, 0.86037900582064208, 0.25995433556249864, 2.6758530146292356, -2.551103286722141,
        0.074592013415484035, 2.5769294276736194, -1.9326858212764007, -1.8671863759174292, 0.69909539963642842, -2.2676740685456749, 1.5484813168915381,
        
        2.0081181489201607, -4.1803464312369787, 7.143359861248018, 3.3614167503648225, -1.5108217074137869, 6.9621276249608242, -3.2759879673821866,
        0.33216956609773046, -7.7017993127030362, 8.3851203219242727, 5.1012812187371761, -1.0898551824489475, 6.4576977368950468, -5.2958868899043061,
        0.43058988840753554, 0.70735358044950758, -3.57739732688104, 0.45060380259422572, 1.2451613707041602, -0.71565412983783139, 0.15251669086964798,
        1.6122402410712584, -2.9410916897723856, 3.2405700870978036, 2.6297751467350068, -0.22489907358255931, 5.2282921306032462, -3.2631135715840829,
        1.8113411937330111, 4.9229676550959907, -6.8986226689948307, -2.1811133108570888, 1.2887325945557524, -1.709121601498848, 1.941018267528074,
        
        1.6122402410712575, -2.9410916897723856, 3.2405700870978036, 2.6297751467350059, -0.22489907358255992, 5.2282921306032435, -3.2631135715840816,
        0.66348110892374246, -4.6715970365313453, 4.2380574980270973, 3.9047685540214845, 0.10940159805107276, 4.1139008338675982, -4.4670387340704387,
        -0.10144198230724713, 1.2559668295007074, -1.1183177544028269, -0.050640382581731563, 1.1053170973217363, -1.4321971783826479, -0.33812559479843418,
        1.383587400601912, -1.1573051598730253, 2.1010665336659988, 1.8674980040972333, 0.44890989538096265, 3.8563596976824845, -2.2440214333817208,
        0.55864612514219414, 3.6969608195738202, -3.1073254379746533, -2.1204511064582681, 0.67490475900572278, -1.890922361132906, 1.3723918015910854
    };
    
    GENERATE_TEST_CASE(2, 3, data);
}

BOOST_AUTO_TEST_CASE(kinetic_fs)
{
    const double data[] = {
        4.995511592463608,
        2.234026210476938,
        11.18212092370772,
        0.2661302775837926,
        -0.1863163645569019,
        6.980044790532832,
        1.989491347976216,

        -2.348788055212056,
        -3.786363118922752,
        16.73897723705461,
        0.5564542167661132,
        -2.15167547198363,
        -0.2390035126927955,
        -9.095014502902735,

        0.8430430100834426,
        -0.7732654372231758,
        11.28954817386076,
        2.451395821796533,
        2.469044951870448,
        0.8817657849866226,
        -9.398910626736674
    };
    
    GENERATE_TEST_CASE(3, 0, data);
}

BOOST_AUTO_TEST_CASE(kinetic_fp)
{
   const double data[] = {
-0.18444514015680488, -0.12117420765329437, 0.68870951643487677, 
3.4758440525650953, 3.615899295024894, 2.3034763014414095, 
-2.3893583521053299, -0.17431949064019694, 0.1098454790626516, 
-1.4461121288415135, -2.8749044467311533, -1.3259556511247381, 
0.82856141253848159, 0.58181799520953958, -0.0469585287558867, 
-1.9873818735748778, -2.529826051588616, -2.2510794101936118, 
4.6607849188766997, 2.9720227174270497, 2.4173805277032194, 
-0.12117420765329255, -2.1526827937662807, -1.4161808825563673, 
3.6158992950248909, 7.0535583651664862, 4.4829357073013787, 
-0.17431949064019137, -6.3442300171715855, -1.2139993262992212, 
-2.8749044467311538, -6.082321671396099, -2.7724527250789905, 
0.58181799520953892, 0.28874895714838278, 1.2821745563791693, 
-2.5298260515886128, -10.019448305790233, -5.2915951671082224, 
2.9720227174270479, 3.2373196260748176, 0.4571329063917412, 
0.68870951643487666, -1.4161808825563666, -0.58716168489875364, 
2.303476301441409, 4.482935707301384, 4.6596465824699695, 
0.10984547906265281, -1.2139993262992295, -3.0262421184118318, 
-1.325955651124737, -2.7724527250789914, -3.6169062309571145, 
-0.046958528755886408, 1.2821745563791693, 1.3234456607981979, 
-2.2510794101936109, -5.2915951671082224, -5.3134625301583904, 
2.417380527703219, 0.45713290639174564, 1.3599443267532449
   };
   
   GENERATE_TEST_CASE(3, 1, data);
}

BOOST_AUTO_TEST_CASE(kinetic_fd)
{
   const double data[] = {
-2.6721198689146695, -2.4916440089283123, 0.62380528632914523, -2.2400773525905522, -0.11527856618756555, 
1.5049662971567457, 4.545323520557325, -0.39805158924872652, 0.47581095004015583, -3.9825272973137764, 
-4.7407947824599637, -5.8692789576017041, 1.982709986130289, -2.8462816428711886, 3.7804643937564055, 
-1.4576519609806189, -4.0641979540450111, -0.33305498452617055, -1.3296766453591744, 2.8856516718723841, 
1.1723023278430058, 0.34757129553668353, -1.1248260973765427, -0.40174760950567989, -1.080420163074481, 
-5.632144116382209, -8.080087838205019, 0.74780483218845806, -4.1354092044270008, 3.5045871968433113, 
2.3859501009635946, 4.5510471359684299, 0.72947722065718723, 2.602678676341315, -2.4933994896508702, 
-3.1034553210584308, -0.51335296578740575, -0.6654571002661922, -2.4916440089283092, -2.7993454812237442, 
6.460535393729872, 11.902780755995591, -1.0931828061492355, 4.5453235205573241, -7.6082227396937965, 
-10.637583902890558, -12.37387094916625, 3.9742402392106575, -5.8692789576016953, 8.6296180468701706, 
-5.1949167960183571, -7.8837982471392678, -0.69638769491835029, -4.0641979540450093, 3.3708114804154965, 
2.3349062750940335, 1.6843216456029189, -1.9243403001791568, 0.34757129553668353, -1.9916776461316166, 
-10.759651784030357, -9.9800783206559736, 1.1060109279311912, -8.0800878382050154, 2.6413697477709412, 
4.3624415392029787, 9.0183333429224621, 0.53104156237125677, 4.5510471359684308, -3.7681421414094176, 
-2.4916440089283123, -1.025379895609424, 0.15677397265665322, -2.1382714372938656, -0.86336219340157472, 
4.5453235205573259, 7.2197408746393528, -1.9410396455920009, 1.7885625198037669, -5.7134849029777222, 
-5.8692789576017033, -6.4868268135325895, 2.6423531200243029, -3.4229650764823165, 4.7637946531475377, 
-4.0641979540450093, -6.0346423107604767, 0.078262409444489006, -2.8861332790593597, 3.2770608008900441, 
0.34757129553668381, -0.16907519698801918, -1.7082173322245022, -0.69376983831603301, -1.0430346275543005, 
-8.0800878382050172, -6.3578467432499286, 2.2133956393186338, -5.9598286236911138, 2.9223345581144811, 
4.5510471359684308, 7.0738832093307895, 0.099287701986493657, 3.1325336586944874, -3.2078273332905742
   };
   
   GENERATE_TEST_CASE(3, 2, data);
}

BOOST_AUTO_TEST_CASE(kinetic_ff)
{
    const double data[] = {
        -1.6184637210994293, -6.9488521041605456, 4.7908786641722747, 2.5108799575684713, -2.2968040034562565, 1.7648649968626273, -4.3349651662713837,
        -6.948852104160542, -2.3222288792605297, -7.5946814216749248, -1.7340698012745352, -0.12803077222514411, -10.0343017266079, 1.1796697391527795,
         4.7292561772373283, -5.7558354215156751, 8.0613861337381021, 6.1675428197330824, -0.40297639681308473, 11.476445138829201, -7.6457339588755024,
         2.510879957568473, -1.7340698012745377, 7.6295599035565598, 1.937643563848505, -1.1667498606412481, 6.3917280799271614, -1.1894121586585162,
        -2.2968040034562556, -0.12803077222514359, -0.69885678672985174, -1.1667498606412481, -0.23103703063280642, -1.6588197338194506, 1.3237347975494225,
         1.7648649968626295, -10.034301726607902, 12.762974473997096, 6.3917280799271614, -1.6588197338194506, 11.473413447728356, -9.3865126825872132,
        -4.2441450846762265, -0.53182257882130157, -7.9806290988215087, -0.47735207713245154, 0.91575432688277902, -8.4079334488629129, 3.5389088949778449,

        -7.7602418298264961, -5.8501190696820675, 0.25378459666742836, -0.66696975092464605, -2.7133205609744597, -10.968321758003231, -2.4307112033637721,
        -5.8501190696820693, 8.8083242486873079, -19.616591977041338, -7.5443548877933129, 1.9865373574697838, -16.788814678439248, 9.1614479844249974,
        -0.84095057761554926, -16.029543077609272, 20.290135658958821, 11.434171309923341, -0.83917541124895012, 12.185658547642101, -13.857289164481864,
        -0.66696975092464372, -7.5443548877933111, 14.527303049658824, 4.0514365425923264, -3.8085608738074894, 6.4917296234955177, -4.7476547349944829,
        -2.713320560974458, 1.9865373574697847, -0.98601712933357788, -3.8085608738074885, -1.8073448778350427, -3.7205432530201277, 4.6516292976161298,
        -10.968321758003222, -16.788814678439241, 17.280994710973474, 6.491729623495516, -3.7205432530201294, -3.3379229653957392, -13.121648309523909,
        -2.3710454869510476, 7.3809930007107694, -15.417776274158692, -3.3320627806147263, 4.3651443419618801, -11.875971637145783, 5.1923121438660527,

        -6.0031387519805541, -5.7945593070097443, 1.888077767106072, 1.1660698909003648, -1.1262966682190918, -5.0600618871889962, -3.3062954375365452,
        -5.7945593070097381, 3.4557015399733122, -9.11771485112547, -5.7677881450452233, -1.5390930776397849, -10.149607859459183, 7.5089448410163424,
         1.1678866503418834, -6.8379421799992777, 5.555994982544405, 6.6605846539543307, 2.5934556218315521, 6.019294854535632, -9.6218548725314808,
         1.1660698909003631, -5.767788145045226, 8.070500469684216, 6.0259277668409696, -0.036265186003027784, 6.5770924142372085, -6.1646775665071036,
        -1.1262966682190902, -1.5390930776397862, 1.9414126963696159, -0.036265186003028381, -1.5715673063453268, 1.9386917728135118, 1.077628050430808,
        -5.0600618871889953, -10.149607859459188, 8.7103069136621389, 6.5770924142372102, 1.9386917728135125, 0.68372933796841351, -13.536452139484187,
        -3.6454133694311235, 6.3747219199267438, -9.9084148296964702, -5.5117820750653719, 1.100750250395375, -12.428029247250924, 6.9719361872473593
    };
    
    GENERATE_TEST_CASE(3, 3, data);
}

BOOST_AUTO_TEST_SUITE_END()
